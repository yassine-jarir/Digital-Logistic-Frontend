<div class="dashboard-container">
  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <div class="spinner"></div>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error()" class="error-container">
    <div class="error-icon">âš ï¸</div>
    <p>{{ error() }}</p>
    <button class="retry-btn" (click)="refreshData()">Retry</button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading() && !error()">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <h1>Warehouse Manager Dashboard</h1>
        <p>Welcome, {{ username() }}!</p>
      </div>
      <button class="refresh-btn" (click)="refreshData()" title="Refresh data">
        <span>ğŸ”„</span>
        <span>Refresh</span>
      </button>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage()" class="alert-section success" style="margin-bottom: 1.5rem;">
      <div class="alert-header">
        <span class="alert-icon">âœ…</span>
        <h2>Success</h2>
      </div>
      <p>{{ successMessage() }}</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="error() && !loading()" class="alert-section warning" style="margin-bottom: 1.5rem;">
      <div class="alert-header">
        <span class="alert-icon">âš ï¸</span>
        <h2>Error</h2>
      </div>
      <p>{{ error() }}</p>
    </div>

    <!-- Key Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card" routerLink="/warehouse/sales-orders">
        <div class="stat-icon sales">ğŸ“¦</div>
        <div class="stat-info">
          <h3>Sales Orders</h3>
          <p class="stat-value">{{ stats().totalSalesOrders }}</p>
          <p class="stat-label">Total orders to fulfill</p>
        </div>
      </div>

      <div class="stat-card" routerLink="/warehouse/purchase-orders">
        <div class="stat-icon purchase">ğŸ“‹</div>
        <div class="stat-info">
          <h3>Purchase Orders</h3>
          <p class="stat-value">{{ stats().totalPurchaseOrders }}</p>
          <p class="stat-label">Total POs managed</p>
        </div>
      </div>

      <div class="stat-card pending">
        <div class="stat-icon">â³</div>
        <div class="stat-info">
          <h3>Pending Approval</h3>
          <p class="stat-value">{{ stats().pendingApproval }}</p>
          <p class="stat-label">Awaiting admin approval</p>
        </div>
      </div>

      <div class="stat-card approved">
        <div class="stat-icon">âœ…</div>
        <div class="stat-info">
          <h3>Approved POs</h3>
          <p class="stat-value">{{ stats().approvedPO }}</p>
          <p class="stat-label">Ready to receive</p>
        </div>
      </div>

      <div class="stat-card received">
        <div class="stat-icon">ğŸ“¥</div>
        <div class="stat-info">
          <h3>Received</h3>
          <p class="stat-value">{{ stats().receivedPO }}</p>
          <p class="stat-label">Completed POs</p>
        </div>
      </div>

      <div class="stat-card warehouses">
        <div class="stat-icon">ğŸ¢</div>
        <div class="stat-info">
          <h3>Warehouses</h3>
          <p class="stat-value">{{ stats().totalWarehouses }}</p>
          <p class="stat-label">Active locations</p>
        </div>
      </div>

      <div class="stat-card" [class.warning]="stats().lowStockItems > 0">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-info">
          <h3>Low Stock Alert</h3>
          <p class="stat-value">{{ stats().lowStockItems }}</p>
          <p class="stat-label">Items below reorder point</p>
        </div>
      </div>

      <div class="stat-card inventory">
        <div class="stat-icon">ğŸ“¦</div>
        <div class="stat-info">
          <h3>Inventory Items</h3>
          <p class="stat-value">{{ inventory().length }}</p>
          <p class="stat-label">Total SKUs in system</p>
        </div>
      </div>
    </div>

    <!-- Status Breakdown Row -->
    <div class="breakdown-grid">
      <!-- Purchase Orders Status Breakdown -->
      <div class="breakdown-card">
        <h3>Purchase Order Status</h3>
        <div class="breakdown-list">
          <div *ngFor="let item of stats().purchaseByStatus" class="breakdown-item">
            <div class="breakdown-bar">
              <div class="bar-fill" [style.width.%]="(item.count / stats().totalPurchaseOrders) * 100" [style.background-color]="item.color"></div>
            </div>
            <div class="breakdown-details">
              <span class="breakdown-status" [style.color]="item.color">{{ item.status }}</span>
              <span class="breakdown-count">{{ item.count }}</span>
            </div>
          </div>
          <div *ngIf="stats().purchaseByStatus.length === 0" class="no-data">No purchase orders</div>
        </div>
      </div>

      <!-- Sales Orders Status Breakdown -->
      <div class="breakdown-card">
        <h3>Sales Order Status</h3>
        <div class="breakdown-list">
          <div *ngFor="let item of stats().salesByStatus" class="breakdown-item">
            <div class="breakdown-bar">
              <div class="bar-fill" [style.width.%]="(item.count / stats().totalSalesOrders) * 100" [style.background-color]="item.color"></div>
            </div>
            <div class="breakdown-details">
              <span class="breakdown-status" [style.color]="item.color">{{ item.status }}</span>
              <span class="breakdown-count">{{ item.count }}</span>
            </div>
          </div>
          <div *ngIf="stats().salesByStatus.length === 0" class="no-data">No sales orders</div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2>Quick Actions</h2>
      <div class="actions-grid">
        <button class="action-btn primary" routerLink="/warehouse/purchase-orders/new">
          <span class="action-icon">â•</span>
          <div class="action-text">
            <span class="action-title">Create Purchase Order</span>
            <span class="action-desc">Order new inventory</span>
          </div>
        </button>
        
        <button class="action-btn secondary" routerLink="/warehouse/purchase-orders">
          <span class="action-icon">ğŸ“‹</span>
          <div class="action-text">
            <span class="action-title">Manage Purchase Orders</span>
            <span class="action-desc">View & receive orders</span>
          </div>
        </button>
        
        <button class="action-btn tertiary" routerLink="/warehouse/sales-orders">
          <span class="action-icon">ğŸ“¦</span>
          <div class="action-text">
            <span class="action-title">View Sales Orders</span>
            <span class="action-desc">Check fulfillment queue</span>
          </div>
        </button>

        <button class="action-btn info" routerLink="/warehouses">
          <span class="action-icon">ğŸ¢</span>
          <div class="action-text">
            <span class="action-title">Manage Warehouses</span>
            <span class="action-desc">View locations & inventory</span>
          </div>
        </button>
      </div>
    </div>

    <!-- Recent Sales Orders -->
    <div class="recent-orders">
      <div class="section-header">
        <h2>Recent Sales Orders</h2>
        <button class="view-all-btn" routerLink="/warehouse/sales-orders">View All â†’</button>
      </div>
      
      <div class="table-container">
        <table *ngIf="stats().recentSalesOrders.length > 0; else noSalesOrders">
          <thead>
            <tr>
              <th>Order #</th>
              <th>Customer</th>
              <th>Warehouse</th>
              <th>Date</th>
              <th>Status</th>
              <th>Items</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of stats().recentSalesOrders" class="clickable-row">
              <td class="font-semibold">{{ order.orderNumber }}</td>
              <td>
                <div>{{ order.customerName }}</div>
                <div class="text-sm text-gray-500">{{ order.customerEmail }}</div>
              </td>
              <td>{{ order.warehouseName || 'N/A' }}</td>
              <td>{{ order.orderDate | date: 'short' }}</td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ order.status }}
                </span>
              </td>
              <td>{{ order.lines.length }} items</td>
              <td class="font-semibold">{{ order.totalAmount | currency }}</td>
            </tr>
          </tbody>
        </table>
        <ng-template #noSalesOrders>
          <div class="no-data">
            <div class="no-data-icon">ğŸ“¦</div>
            <p>No sales orders found</p>
            <p class="text-sm">Sales orders will appear here when customers place orders</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Recent Purchase Orders -->
    <div class="recent-orders">
      <div class="section-header">
        <h2>Recent Purchase Orders</h2>
        <button class="view-all-btn" routerLink="/warehouse/purchase-orders">View All â†’</button>
      </div>
      
      <div class="table-container">
        <table *ngIf="stats().recentPurchaseOrders.length > 0; else noPurchaseOrders">
          <thead>
            <tr>
              <th>Order #</th>
              <th>Supplier</th>
              <th>Warehouse</th>
              <th>Order Date</th>
              <th>Expected Delivery</th>
              <th>Status</th>
              <th>Total</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of stats().recentPurchaseOrders">
              <td class="font-semibold">{{ order.orderNumber }}</td>
              <td>{{ order.supplierName }}</td>
              <td>{{ order.warehouseName || 'N/A' }}</td>
              <td>{{ order.orderDate | date: 'short' }}</td>
              <td>{{ order.expectedDeliveryDate | date: 'short' }}</td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ order.status }}
                </span>
              </td>
              <td class="font-semibold">{{ order.totalAmount | currency }}</td>
              <td>
                <button 
                  *ngIf="order.status === 'APPROVED'" 
                  (click)="receivePurchaseOrder(order, $event)"
                  [disabled]="isReceiving(order.id)"
                  class="action-link receive"
                  style="background: #10b981; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem;">
                  <span *ngIf="isReceiving(order.id)" style="display: inline-block; width: 1rem; height: 1rem; border: 2px solid white; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></span>
                  <span *ngIf="!isReceiving(order.id)">âœ…</span>
                  {{ isReceiving(order.id) ? 'Receiving...' : 'Receive' }}
                </button>
                <button 
                  *ngIf="order.status !== 'APPROVED'" 
                  class="action-link view"
                  [routerLink]="['/warehouse/purchase-orders', order.id]">
                  View â†’
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <ng-template #noPurchaseOrders>
          <div class="no-data">
            <div class="no-data-icon">ğŸ“‹</div>
            <p>No purchase orders found</p>
            <p class="text-sm">Create your first purchase order to restock inventory</p>
            <button class="create-btn" routerLink="/warehouse/purchase-orders/new">
              Create Purchase Order
            </button>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Low Stock Items Alert -->
    <div *ngIf="stats().lowStockItems > 0" class="alert-section warning">
      <div class="alert-header">
        <span class="alert-icon">âš ï¸</span>
        <h2>Low Stock Alert</h2>
      </div>
      <p>{{ stats().lowStockItems }} item(s) are below reorder point. Consider creating purchase orders to restock.</p>
      <button class="action-btn primary" routerLink="/warehouse/purchase-orders/new">
        Create Purchase Order
      </button>
    </div>
  </div>
</div>
